<div class="page">
  <header class="topbar">
    <button class="icon-btn" (click)="openMenu()" aria-label="Menu">&#9776;</button>

    <div class="brand">FilmAholic</div>

    <div class="search">
      <div class="search-pill" role="search">
        <button class="pill-icon left" type="button" aria-label="Opcoes">
          &#9776;
        </button>

        <input type="text"
               [(ngModel)]="searchTerm"
               placeholder="Pesquisar filmes..."
               aria-label="Pesquisar" />

        <button class="pill-icon right" type="button" aria-label="Pesquisar">
          &#128269;
        </button>
      </div>
    </div>

    <div class="top-actions">
      <button class="icon-btn" aria-label="Favoritos">&#128278;</button>

      <button class="icon-btn" routerLink="/profile" aria-label="Perfil">&#128100;</button>
    </div>
  </header>

  <main class="content">
    <div class="state" *ngIf="isLoadingMovies">A carregar filmes&hellip;</div>
    <div class="state error" *ngIf="!isLoadingMovies && errorMovies">
      {{ errorMovies }}
    </div>

    <section class="strip strip-full" *ngIf="!isLoadingMovies && featured.length">
      <div class="strip-inner">
        <div class="section-head">
          <h2>Em Destaque</h2>
        </div>

        <div class="carousel hero">
          <button class="chevron left"
                  (click)="prevFeatured()"
                  [disabled]="featuredIndex === 0"
                  aria-label="Anterior">
            &lsaquo;
          </button>

          <div class="carousel-track">
            <a class="poster-card hero"
               *ngFor="let f of featuredVisible"
               [routerLink]="['/movie-detail', f.id]">
              <img [src]="posterOf(f)" [alt]="f.titulo" />
            </a>
          </div>

          <button class="chevron right"
                  (click)="nextFeatured()"
                  [disabled]="featuredIndex >= (featured.length - featuredVisibleCount)"
                  aria-label="Seguinte">
            &rsaquo;
          </button>
        </div>
      </div>
    </section>

    <section class="strip strip-full top10-strip" *ngIf="!isLoadingMovies && top10.length">
      <div class="strip-inner">
        <div class="section-head">
          <h2>Top 10 filmes</h2>
        </div>

        <div class="carousel top10">
          <button class="chevron left"
                  (click)="prevTop10()"
                  [disabled]="top10Index === 0"
                  aria-label="Anterior">
            &lsaquo;
          </button>

          <div class="carousel-track">
            <a class="poster-card small"
               *ngFor="let f of top10Visible"
               [routerLink]="['/movie-detail', f.id]">
              <img [src]="posterOf(f)" [alt]="f.titulo" />
            </a>
          </div>

          <button class="chevron right"
                  (click)="nextTop10()"
                  [disabled]="top10Index >= (top10.length - top10VisibleCount)"
                  aria-label="Seguinte">
            &rsaquo;
          </button>
        </div>
      </div>
    </section>

    <div class="state" *ngIf="isLoadingActors">A carregar atores&hellip;</div>
    <div class="state error" *ngIf="!isLoadingActors && errorActors">
      {{ errorActors }}
    </div>

    <section class="strip strip-full" *ngIf="!isLoadingActors && atores.length">
      <div class="strip-inner">
        <div class="section-head">
          <h2>Top 10 atores</h2>
        </div>

        <div class="carousel top10">
          <button class="chevron left"
                  (click)="prevAtores()"
                  [disabled]="atoresIndex === 0"
                  aria-label="Anterior">
            &lsaquo;
          </button>

          <div class="carousel-track">
            <div class="actor-card" *ngFor="let a of atoresVisible">
              <img class="actor-photo" [src]="fotoAtor(a)" [alt]="a.nome" />
              <div class="actor-name">{{ a.nome }}</div>
            </div>
          </div>

          <button class="chevron right"
                  (click)="nextAtores()"
                  [disabled]="atoresIndex >= (atores.length - atoresVisibleCount)"
                  aria-label="Seguinte">
            &rsaquo;
          </button>
        </div>
      </div>
    </section>
  </main>
</div>

<div class="modal-overlay" *ngIf="isDesafiosOpen" (click)="closeDesafios()">
  <div class="modal-box" (click)="$event.stopPropagation()">
    <button class="modal-close" (click)="closeDesafios()">&times;</button>

    <h3>Desafios Semanais</h3>

    <div *ngIf="isLoadingDesafios" class="modal-loading">Loading desafios...</div>

    <div class="desafios-list" *ngIf="!isLoadingDesafios">
      <div class="desafio-row" *ngFor="let d of desafios" [class.completed]="isCompleted(d)">
        <div class="desafio-meta">
          <h4 class="desafio-title">{{ d.descricao }}</h4>

          <div class="desafio-sub">
            {{ d.genero }} &middot; {{ d.dataInicio | date:'shortDate' }} - {{ d.dataFim | date:'shortDate' }}
          </div>
        </div>

        <div class="desafio-progress">
          <div class="progress-text">
            <span *ngIf="!isCompleted(d)">
              {{ d.progresso }} / {{ d.quantidadeNecessaria }}
            </span>

            <span *ngIf="isCompleted(d)" aria-live="polite">&#10003; Completed</span>
          </div>

          <div class="progress-bar" aria-hidden="true">
            <div class="progress-fill"
                 [style.width.%]="computeProgressPercent(d.progresso, d.quantidadeNecessaria)"></div>
          </div>

          <div class="xp-badge">+{{ d.xp }} XP</div>
        </div>
      </div>

      <div *ngIf="desafios.length === 0" class="empty-list-message">
        Nenhum desafio disponivel.
      </div>
    </div>

    <div class="modal-actions">
      <button class="save-btn" (click)="closeDesafios()">Close</button>
    </div>
  </div>
</div>
