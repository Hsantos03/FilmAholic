<div class="page">
  <!-- TOPBAR (mockup style) -->
  <header class="topbar">
    <button class="icon-btn" (click)="openMenu()" aria-label="Menu">‚ò∞</button>

    <div class="brand">FilmAholic</div>

    <div class="search">
      <input type="text"
             [(ngModel)]="searchTerm"
             placeholder="Pesquisar filmes..."
             aria-label="Pesquisar" />
      <button class="icon-btn search-btn" aria-label="Pesquisar">üîç</button>
    </div>

    <div class="top-actions">
      <!-- √≠cone ‚Äúbookmark‚Äù -->
      <button class="icon-btn" aria-label="Favoritos">üîñ</button>

      <!-- perfil -->
      <button class="icon-btn" routerLink="/profile" aria-label="Perfil">üë§</button>
    </div>
  </header>

  <main class="content">
    <!-- mini header/botoes -->
    <div class="welcome-row">
      <div class="welcome-text">
        <div class="welcome-title">Bem-vindo, {{ userName }}!</div>
        <div class="welcome-sub">Explora os filmes e acompanha os teus desafios.</div>
      </div>

      <div class="welcome-actions">
        <button class="primary-btn" (click)="openDesafios()">Desafios Semanais</button>
      </div>
    </div>

    <div class="state" *ngIf="isLoadingMovies">A carregar filmes‚Ä¶</div>
    <div class="state error" *ngIf="!isLoadingMovies && errorMovies">
      {{ errorMovies }}
    </div>

    <!-- EM DESTAQUE -->
    <section class="section" *ngIf="!isLoadingMovies && featured.length">
      <div class="section-head">
        <h2>Em Destaque</h2>
      </div>

      <div class="carousel">
        <button class="arrow left"
                (click)="prevFeatured()"
                [disabled]="featuredIndex === 0"
                aria-label="Anterior">
          ‚Äπ
        </button>

        <div class="carousel-track">
          <a class="poster-card"
             *ngFor="let f of featuredVisible"
             [routerLink]="['/movie-detail', f.id]">
            <img [src]="posterOf(f)" [alt]="f.titulo" />
          </a>
        </div>

        <button class="arrow right"
                (click)="nextFeatured()"
                [disabled]="featuredIndex >= (featured.length - featuredVisibleCount)"
                aria-label="Seguinte">
          ‚Ä∫
        </button>
      </div>
    </section>

    <!-- TOP 10 FILMES -->
    <section class="section" *ngIf="!isLoadingMovies && top10.length">
      <div class="section-head">
        <h2>Top 10 filmes</h2>
      </div>

      <div class="row-scroll">
        <a class="poster-card small"
           *ngFor="let f of top10"
           [routerLink]="['/movie-detail', f.id]">
          <img [src]="posterOf(f)" [alt]="f.titulo" />
        </a>
      </div>
    </section>
  </main>
</div>

<!-- ===== MODAL: DESAFIOS ===== -->
<div class="modal-overlay" *ngIf="isDesafiosOpen" (click)="closeDesafios()">
  <div class="modal-box" (click)="$event.stopPropagation()">
    <button class="modal-close" (click)="closeDesafios()">√ó</button>

    <h3>Desafios Semanais</h3>

    <div *ngIf="isLoadingDesafios" class="modal-loading">Loading desafios...</div>

    <div class="desafios-list" *ngIf="!isLoadingDesafios">
      <div class="desafio-row" *ngFor="let d of desafios" [class.completed]="isCompleted(d)">
        <div class="desafio-meta">
          <h4 class="desafio-title">{{ d.descricao }}</h4>

          <div class="desafio-sub">
            {{ d.genero }} ¬∑ {{ d.dataInicio | date:'shortDate' }} - {{ d.dataFim | date:'shortDate' }}
          </div>
        </div>

        <div class="desafio-progress">
          <div class="progress-text">
            <span *ngIf="!isCompleted(d)">
              {{ d.progresso }} / {{ d.quantidadeNecessaria }}
            </span>

            <span *ngIf="isCompleted(d)" aria-live="polite">‚úì Completed</span>
          </div>

          <div class="progress-bar" aria-hidden="true">
            <div class="progress-fill"
                 [style.width.%]="computeProgressPercent(d.progresso, d.quantidadeNecessaria)"></div>
          </div>

          <div class="xp-badge">+{{ d.xp }} XP</div>
        </div>
      </div>

      <div *ngIf="desafios.length === 0" class="empty-list-message">
        Nenhum desafio dispon√≠vel.
      </div>
    </div>

    <div class="modal-actions">
      <button class="save-btn" (click)="closeDesafios()">Close</button>
    </div>
  </div>
</div>
