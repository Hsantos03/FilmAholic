<!-- Header -->
<div class="profile-header">
  <button class="edit-btn" (click)="openEdit()">âœŽ</button>
</div>

<!-- Profile body -->
<div class="profile-body">

  <!-- LEFT COLUMN -->
  <div class="profile-left">

    <!-- Avatar -->
    <div class="avatar">
      <span>ðŸ‘¤</span>
    </div>

    <!-- Sidebar -->
    <aside class="profile-sidebar">

      <button class="primary-btn" (click)="openEdit()">Manage Account</button>

      <ul class="menu">
        <li>Preferences</li>
        <li>Achievements</li>
        <li class="logout" (click)="logout()">Log out</li>
        <li class="logout" (click)="openDeleteConfirm()">Delete account</li>
      </ul>

      <div class="stats">
        <h3>Statistics</h3>
        <p>Movies watched: {{ stats?.totalFilmes || 0 }}</p>
        <p>Total hours: {{ (stats?.totalHoras || 0) | number:'1.1-2' }}h</p>

        <div class="genres" *ngIf="stats?.generos?.length">
          <div class="genre-row" *ngFor="let g of stats.generos">
            <span>{{ g.genero }}</span>
            <span>{{ g.total }}</span>
          </div>
        </div>
      </div>

      <div class="list-counts">
        <p><strong>Watch later</strong> ({{ watchLater.length }})</p>
        <p><strong>Watched</strong> ({{ watched.length }})</p>
      </div>

    </aside>
  </div>

  <!-- RIGHT COLUMN -->
  <section class="profile-main">

    <!-- Profile info -->
    <div class="profile-info">
      <h2>{{ userName }}</h2>
      <span class="joined">Joined Â· {{ joined }}</span>

      <p class="bio">{{ bio }}</p>
    </div>

    <!-- CATALOGO (hardcoded) + BOTÃ•ES -->
    <div class="section">
      <h3>Catalog</h3>
      <span class="subtitle">Hardcoded movies (FilmSeed)</span>

      <div class="cards">
        <div class="movie-card" *ngFor="let f of catalogo">
          <img class="poster" [src]="f.posterUrl" [alt]="f.titulo" />

          <div class="movie-meta">
            <div class="movie-title">{{ f.titulo }}</div>
            <div class="movie-sub">{{ f.genero }} Â· {{ f.duracao }} min</div>
          </div>

          <div class="movie-actions">
            <button class="action-btn"
                    (click)="addToWatchLater(f.id)"
                    [disabled]="isSavingMovie || inWatchLater(f.id)"
                    title="Add to Watch later">
              + Watch later
            </button>

            <button class="action-btn ghost"
                    (click)="addToWatched(f.id)"
                    [disabled]="isSavingMovie || inWatched(f.id)"
                    title="Mark as Watched">
              âœ“ Watched
            </button>

            <button class="action-btn danger"
                    *ngIf="inWatchLater(f.id) || inWatched(f.id)"
                    (click)="removeFromLists(f.id)"
                    [disabled]="isSavingMovie">
              Remove
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Watch later -->
    <div class="section">
      <h3>Watch later</h3>
      <span class="subtitle">{{ watchLater.length }} Titles</span>

      <div class="cards">
        <div class="card" *ngFor="let movie of watchLater">
          <img [src]="movie.filme?.posterUrl || 'https://via.placeholder.com/120x180'"
               alt="movie poster" />
        </div>
      </div>
    </div>

    <!-- Watched -->
    <div class="section">
      <h3>Watched</h3>
      <span class="subtitle">{{ watched.length }} Titles</span>

      <div class="cards">
        <div class="card" *ngFor="let movie of watched">
          <img [src]="movie.filme?.posterUrl || 'https://via.placeholder.com/120x180'"
               alt="movie poster" />
        </div>
      </div>
    </div>

  </section>
</div>

<!-- EDIT MODAL -->
<div class="modal-overlay" *ngIf="isEditing" (click)="closeEdit()">
  <div class="modal-box" (click)="$event.stopPropagation()">
    <button class="modal-close" (click)="closeEdit()">Ã—</button>

    <h3>Edit account</h3>

    <form (ngSubmit)="saveChanges()">
      <label for="userName">Username</label>
      <input id="userName" name="userName" type="text" [(ngModel)]="editUserName" required />

      <label for="bio">Bio</label>
      <textarea id="bio" name="bio" rows="4" [(ngModel)]="editBio"></textarea>

      <div class="modal-actions">
        <button type="submit" class="save-btn">Save</button>
        <button type="button" class="cancel-btn" (click)="closeEdit()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<!-- DELETE ACCOUNT MODAL (similar to Manage Account modal) -->
<div class="modal-overlay" *ngIf="isDeleting" (click)="closeDeleteConfirm()">
  <div class="modal-box" (click)="$event.stopPropagation()">
    <button class="modal-close" (click)="closeDeleteConfirm()">Ã—</button>

    <h3>Delete account</h3>

    <p class="delete-info">Para apagar a sua conta escreva <strong>delete</strong></p>

    <form (ngSubmit)="confirmDelete()">
      <!-- removed the English label as requested; input keeps an accessible aria-label in Portuguese -->
      <input id="deleteInput"
             name="deleteInput"
             type="text"
             [(ngModel)]="deleteInput"
             autocomplete="off"
             aria-label="Escreva 'delete' para confirmar" />

      <div class="modal-actions">
        <button type="submit" class="danger-btn" [disabled]="(deleteInput || '').trim().toLowerCase() !== deleteRequiredText || isDeletingSaving">
          Confirm
        </button>
        <button type="button" class="cancel-btn" (click)="closeDeleteConfirm()" [disabled]="isDeletingSaving">Cancel</button>
      </div>
    </form>
  </div>
</div>
