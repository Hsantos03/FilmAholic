<div class="page-wrapper">
  <div class="register-card">
    <div class="header">
      <h1>Registo</h1>
      <p>Get started for free</p>
    </div>

    <!-- Mensagem de verificaÃ§Ã£o de email -->
    <div *ngIf="showVerificationMessage" style="background-color: #d1ecf1; border: 1px solid #bee5eb; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
      <h3 style="color: #0c5460; margin-top: 0;">ğŸ“§ Verifique o seu email!</h3>
      <p style="color: #0c5460; margin-bottom: 15px;">
        Enviamos um email de verificaÃ§Ã£o para <strong>{{ registeredEmail }}</strong>.
        Por favor, clique no link no email para ativar a sua conta.
      </p>
      <p style="color: #856404; font-size: 14px; margin-bottom: 15px;">
        <strong>Nota:</strong> Se nÃ£o receber o email, verifique a pasta de spam ou lixo eletrÃ³nico.
      </p>
      <div style="display: flex; gap: 10px; align-items: center;">
        <button 
          type="button"
          (click)="reenviarEmail()"
          [disabled]="isLoading"
          style="padding: 10px 20px; background-color: #17a2b8; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px;">
          {{ isLoading ? 'A enviar...' : 'Reenviar Email' }}
        </button>
        <a routerLink="/login" style="color: #007bff; text-decoration: none; font-size: 14px;">Ir para Login</a>
      </div>
    </div>

    <!-- FormulÃ¡rio de registo -->
    <form *ngIf="!showVerificationMessage" (ngSubmit)="onRegister()">
      <input
        type="text"
        name="userName"
        [(ngModel)]="user.userName"
        placeholder="Username"
        required
        pattern="^[a-zA-Z0-9_]{3,}$"
        title="MÃ­nimo 3 caracteres, apenas letras, nÃºmeros e underscore (_)">

      <div class="input-row" style="display: flex; gap: 10px;">
        <input
          type="text"
          name="nome"
          [(ngModel)]="user.nome"
          placeholder="Nome"
          required
          pattern="^[A-Za-zÃ€-Ã¿\s]+$"
          title="SÃ³ sÃ£o permitidas letras e espaÃ§os (ex: JoÃ£o, Ana Maria)">

        <input
          type="text"
          name="sobrenome"
          [(ngModel)]="user.sobrenome"
          placeholder="Sobrenome"
          required
          pattern="^[A-Za-zÃ€-Ã¿\s]+$"
          title="SÃ³ sÃ£o permitidas letras e espaÃ§os (ex: Almeida, DembÃ©lÃ©)">
      </div>

      <input
        type="email"
        name="email"
        [(ngModel)]="user.email"
        placeholder="Email"
        required
        pattern="^[^\\s@]+@[^\\s@]+\\.com$"
        title="Introduza um email no formato nome@dominio.com">

      <input
        type="date"
        name="dataNascimento"
        [(ngModel)]="user.dataNascimento"
        [max]="todayISO"
        required
        title="A data nÃ£o pode ser futura">

      <div class="password-container">
        <div class="password-input-wrapper">
          <input
            [type]="showPassword ? 'text' : 'password'"
            name="password"
            [(ngModel)]="user.password"
            (input)="checkPasswordRequirements()"
            placeholder="Password"
            required
            class="password-input"
            [class.password-invalid]="user.password && !isPasswordValid">
          <button type="button" class="password-toggle-btn" (click)="toggleShowPassword()" tabindex="-1">
            <span *ngIf="!showPassword">ğŸ‘</span>
            <span *ngIf="showPassword" class="eye-crossed">ğŸ‘</span>
          </button>
        </div>
        
        <!-- Mensagem de erro se tentar submeter sem password vÃ¡lida -->
        <div *ngIf="showPasswordError && !isPasswordValid" class="password-error-message">
          Por favor, certifique-se de que a password cumpre todos os requisitos acima.
        </div>

        <!-- Lista de requisitos da password -->
        <div *ngIf="user.password" class="password-requirements">
          <div class="password-requirements-title">
            A password deve conter:
          </div>
          <ul class="password-requirements-list">
            <li [class.requirement-met]="passwordRequirements.minLength" [class.requirement-unmet]="!passwordRequirements.minLength">
              <span class="requirement-icon">{{ passwordRequirements.minLength ? 'âœ“' : 'âœ—' }}</span>
              Pelo menos 8 caracteres
            </li>
            <li [class.requirement-met]="passwordRequirements.hasUppercase" [class.requirement-unmet]="!passwordRequirements.hasUppercase">
              <span class="requirement-icon">{{ passwordRequirements.hasUppercase ? 'âœ“' : 'âœ—' }}</span>
              Uma letra maiÃºscula
            </li>
            <li [class.requirement-met]="passwordRequirements.hasLowercase" [class.requirement-unmet]="!passwordRequirements.hasLowercase">
              <span class="requirement-icon">{{ passwordRequirements.hasLowercase ? 'âœ“' : 'âœ—' }}</span>
              Uma letra minÃºscula
            </li>
            <li [class.requirement-met]="passwordRequirements.hasDigit" [class.requirement-unmet]="!passwordRequirements.hasDigit">
              <span class="requirement-icon">{{ passwordRequirements.hasDigit ? 'âœ“' : 'âœ—' }}</span>
              Um nÃºmero
            </li>
            <li [class.requirement-met]="passwordRequirements.hasSpecialChar" [class.requirement-unmet]="!passwordRequirements.hasSpecialChar">
              <span class="requirement-icon">{{ passwordRequirements.hasSpecialChar ? 'âœ“' : 'âœ—' }}</span>
              Um sÃ­mbolo especial (!&#64;#$%^&amp;*...)
            </li>
          </ul>
        </div>
      </div>

      <div class="password-container">
        <div class="password-input-wrapper">
          <input
            [type]="showConfirmPassword ? 'text' : 'password'"
            name="confirmPassword"
            [(ngModel)]="user.confirmPassword"
            (input)="checkPasswordMatch()"
            placeholder="Confirmar Password"
            required
            class="password-input"
            [class.password-invalid]="user.confirmPassword && user.password !== user.confirmPassword">
          <button type="button" class="password-toggle-btn" (click)="toggleShowConfirmPassword()" tabindex="-1">
            <span *ngIf="!showConfirmPassword">ğŸ‘</span>
            <span *ngIf="showConfirmPassword" class="eye-crossed">ğŸ‘</span>
          </button>
        </div>
        
        <div *ngIf="showPasswordMismatch || (user.confirmPassword && user.password !== user.confirmPassword)" class="password-error-message">
          As passwords nÃ£o coincidem.
        </div>
      </div>

      <button type="submit"
              [disabled]="isLoading || !isPasswordValid"
              [style.opacity]="isLoading || !isPasswordValid ? 0.6 : 1"
              class="btn-register">
        {{ isLoading ? 'A processar...' : 'Criar Conta' }}
      </button>

      <div style="display: flex; align-items: center; margin: 20px 0;">
        <div style="flex: 1; height: 1px; background-color: #ddd;"></div>
        <span style="padding: 0 15px; color: #666; font-size: 14px;">ou</span>
        <div style="flex: 1; height: 1px; background-color: #ddd;"></div>
      </div>

      <!-- BotÃµes de registo/login social -->
      <div style="display: flex; flex-direction: column; gap: 10px;">
        <button 
          type="button" 
          (click)="registarComGoogle()"
          style="width: 100%; padding: 12px; background-color: #fff; color: #333; border: 1px solid #ddd; border-radius: 10px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
          <svg width="18" height="18" viewBox="0 0 18 18">
            <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/>
            <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
            <path fill="#FBBC05" d="M3.964 10.707c-.18-.54-.282-1.117-.282-1.707s.102-1.167.282-1.707V4.961H.957C.348 6.175 0 7.55 0 9s.348 2.825.957 4.039l3.007-2.332z"/>
            <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.961L3.964 7.293C4.672 5.163 6.656 3.58 9 3.58z"/>
          </svg>
          Continuar com Google
        </button>

        <button 
          type="button" 
          (click)="registarComFacebook()"
          style="width: 100%; padding: 12px; background-color: #1877F2; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;">
          <svg width="18" height="18" viewBox="0 0 18 18" fill="white">
            <path d="M18 9a9 9 0 1 0-10.406 8.89v-6.288H5.309V9h2.285V7.017c0-2.255 1.343-3.5 3.4-3.5.984 0 2.014.175 2.014.175v2.215h-1.135c-1.118 0-1.467.694-1.467 1.407V9h2.494l-.398 2.602h-2.096v6.288A9.001 9.001 0 0 0 18 9z"/>
          </svg>
          Continuar com Facebook
        </button>
      </div>

      <div class="footer-links">
        <a routerLink="/login">JÃ¡ tenho uma conta</a>
      </div>
    </form>
  </div>
</div>
